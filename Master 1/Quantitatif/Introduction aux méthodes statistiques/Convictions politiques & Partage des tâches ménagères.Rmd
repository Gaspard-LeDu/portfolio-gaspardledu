# Introduction aux méthodes statistiques

# Cours introductif aux opérations statistiques de base sur R, en utilisant l'environnement RStudio. 
# Le travail final a été réalisé par groupes de 3 sur le questionnaire ISSP 2012 - Family and Changing Gender Roles IV.
# Le Choix du sujet était libre, à partir du moment où les outils étudiées en cours étaient utilisés pour produire un raisonnement sociologique. 

# Le sujet choisi visait à croiser les convictions politiques des individus à la répartition des tâches ménagères dans leur couple. 
# Le but était de vérifier l’existence d’un lien significatif entre les deux variables


# On commence par l'importation des libraries et des données #
library(foreign)
library(questionr)
library(forcats)
library(clipr)

dataTTL <- read.spss("C:/Users/gsprd/.../DATA.sav", to.data.fram = TRUE)
dataFRA <- subset(dataTTL, V3 == "FR-France")

# On cherche d'abord à établir une échelle de conservatisme, en attribuant des points de conservatisme à certaines réponses
# On recode donc certaines réponses au questionnaire en variables quantitatives
# Exemple : "Le rôle d’un homme, c’est de gagner l’argent du ménage ; le rôle d’une femme, c’est de s’occuper de la maison et de la famille" (Question 2 - 0 à 4 points)

# Recodage de la question 2 ("Le rôle d’un homme, c’est de gagner l’argent du ménage ; le rôle d’une femme, c’est de s’occuper de la maison et de la famille")
dataFRA$V7_rec <- dataFRA$V7 %>%
  fct_recode(
    "4" = "Strongly agree",
    "3" = "Agree",
    "1" = "Neither agree nor disagree",
    "0" = "Disagree",
    "0" = "Strongly disagree"
  ) %>%
  as.character() %>%
  as.numeric()

# Recodage de la question 4 (Il n’y a pas de problème pour un couple à vivre ensemble sans avoir l’intention de se marier
dataFRA$V8_rec <- dataFRA$V8 %>%
  fct_recode(
    "0" = "Strongly agree",
    "0" = "Agree",
    "1" = "Neither agree nor disagree",
    "3" = "Disagree",
    "4" = "Strongly disagree"
  ) %>%
  as.character() %>%
  as.numeric()
# etc, etc...
# On suit la même procédure pour chaque question portant sur les convictions du répondant

# On additionne ensuite tous les points obtenus pour former une échelle de conservatisme (échelle CONSERV)
dataFRA$scoreCONSERV <- dataFRA$V7_rec+dataFRA$V8_rec+dataFRA$V9_rec+dataFRA$V10_rec+dataFRA$V11_rec+dataFRA$V15_rec+dataFRA$V16_rec+dataFRA$V17_rec+dataFRA$V19_rec+dataFRA$V20_rec+dataFRA$V31_rec+dataFRA$V32_rec+dataFRA$FR_PRTY_rec+dataFRA$PARTY_LR_rec

# Premières analyses de l'échelle de conservatisme
freq(dataFRA$scoreCONSERV)
table(dataFRA$scoreCONSERV)

# Quantilisation de l'échelle #
# Recodage de dataFRA$scoreCONSERV en dataFRA$scoreCONSERV_rec
dataFRA$scoreCONS_rec <- cut(dataFRA$scoreCONS,
                             include.lowest = TRUE,
                             right = FALSE,
                             dig.lab = 4,
                             breaks = c(0, 8, 14, 21, 44)
)

# Analyses de l'échelle quantilisée
freq(dataFRA$scoreCONSERV_rec)
table(dataFRA$scoreCONSERV_rec)

# À UTILISER + TARD
freq(dataFRA$scorePART)

# On veut ensuite comparer le conservatisme d'un individu avec sa participation aux tâches ménagères
# On commence par transformer le score CONSERV en variable qualitative

# Recodage de dataFRA$scoreCONSERV_rec en dataFRA$scoreCONSERV_rec_rec
dataFRA$CONSERV <- dataFRA$scoreCONSERV_rec %>%
  fct_recode(
    "CONSERV minime" = "[0,8)",
    "CONSERV faible" = "[8,14)",
    "CONSERV élevé" = "[14,21)",
    "CONSERV extrême" = "[21,44]"
  )

# Le score CONSERV est ensuite comparé à la participation de l'individu aux tâches ménagères
tabV42 <- table(dataFRA$CONSERV, dataFRA$V42)
lprop(tabV42)
cprop(tabV42)
chisq.test(tabV42)
cramer.v(tabV42)
write_clip(lprop(tabV42))

# On remarque alors que les tâches ménagères en fonction des convictions sont réparties de manière étrange : plus le score CONSERV est minime, plus l'individu répond "MOI" à la question "Dans votre foyer, qui s'occuper des tâches suivantes ? - Laver le linge"
# C'est parce qu'une variable lourde, le genre, pèse sur les réponses aux questions. Il faut donc distinguer le genre des répondants
# On va donc regarder la répartition du genre dans l'échelle de conservatisme, puis séparer les réponses en fonction du genre

# Analyse de la répartition du genre dans l'échelle de conservatisme
tabSEX <- table(dataFRA$SEX, dataFRA$CONSERV)
lprop(tabSEX)
cprop(tabSEX)
prop(tabSEX)
chisq.test(tabSEX)
cramer.v(tabSEX)
write_clip(lprop(tabSEX))


# Séparation du score CONSERV en fonction du genre
dataFEM <- subset (dataFRA, SEX  == "Female")
dataMEN <- subset (dataFRA, SEX == "Male")

# On regarde la répartition des tâches en fonction des convictions politiques, mais d'un point de vue genré cette fois
tabV42FEM <- table(dataFEM$CONSERV, dataFEM$V42)
tabV42MEN <- table(dataMEN$CONSERV, dataMEN$V42)
write_clip(lprop(tabV42))

# On se rend compte qu'il y a une grande différence femme-homme dans les résultats
# Les répondants masculins sont très peu à répondre "moi" aux tâches ménagères, et inversement la réponse "moi" est surreprésentée chez les femmes
# L'idéologie ne semble pas peser dans les réponses

# Pour le prouver, on va établir le coefficient de corrélation entre convictions et égalité du partage des tâches
# Il nous faut donc deux variables quantitatives : un score de convervatisme (CONSERV) et un score d'égalité (PART)

# Recodage d'une question portant sur le partage du ménage, plus la répartition est égalitaire, plus la réponse vaut des points
dataFRA$V42_rec <- dataFRA$V42 %>%
  fct_recode(
    "0" = "Always me",
    "2" = "Usually me",
    "3" = "About equal or both together",
    "2" = "Usually my spouse/ partner",
    "0" = "Always my spouse/ partner",
    "0" = "Is done by a third person"
  ) %>%
  as.character() %>%
  as.numeric()

# Même procédure sur une question portant sur le partage des charges financières
dataFRA$V41_rec <- dataFRA$V41 %>%
  fct_recode(
    "0" = "I manage all and give partner his share",
    "0" = "Partner manages all and gives me my share",
    "3" = "We pool all money, each take out",
    "2" = "We pool some money, rest separate",
    "1" = "We each keep own money separate",
    "0" = "TW: My son or my daughter-in-law manages the money"
  ) %>%
  as.character() %>%
  as.numeric()
# etc, etc...
# On répète le recodage sur l'ensemble des questions portant sur la répartition des tâches ménagères dans le couple

# Ensuite, on agrège les réponses en un score de partage égalitaire des tâches (PART)
dataFRA$scorePART <- dataFRA$V37_rec+dataFRA$V38_rec+dataFRA$V39_rec+dataFRA$V41_rec+dataFRA$V42_rec+dataFRA$V42_rec+dataFRA$V43_rec+dataFRA$V44_rec+dataFRA$V45_rec+dataFRA$V46_rec+dataFRA$V47_rec+dataFRA$V48_rec+dataFRA$V49_rec+dataFRA$V51_rec+dataFRA$V52_rec+dataFRA$V53_rec+dataFRA$V54_rec+dataFRA$V64_rec

# Quantilisation du score pour voir la répartition des individus le long de l'échelle
dataFRA$scorePART_rec <- cut(dataFRA$scorePART,
  include.lowest = TRUE,
  right = FALSE,
  dig.lab = 4,
  breaks = c(10, 23, 26, 29.75, 40)
)

# On étudie 
tabCONSERVPART <- table(dataFRA$scoreCONSERV, dataFRA$scorePART)
write_clip(table(dataFRA$scoreCONSERV, dataFRA$scorePART))
chisq.test(tabCONSERVPART)
cramer.v(tabCONSERVPART)

plot(dataFRA$scoreCONSERV, dataFRA$scorePARTT, 
     main = "Partage égalitaire des tâches & Conservatisme",
     xlab = "Score de conservatisme",
     ylab = "Score de partage égalitaire des tâches")

cor(dataFRA$scoreCONSERV, dataFRA$scorePART, use = "complete.obs")
reg <- lm(dataFRA$scorePART ~ dataFRA$scoreCONSERV)
summary(reg)
abline(reg, col ="red")



#### QUI SONT LES HYPOCRITES ####

dataFRA$Hypo <- NA
dataFRA$Hypo[dataFRA$scoreCONS_rec == "[21,44]" & dataFRA$scorePET_rec == "[29.75,40]"]<- "Hypocrites"
dataFRA$Hypo[dataFRA$scoreCONS_rec == "[0,8]" & dataFRA$scorePET_rec == "[10,23]"]<- "Hypocrites"

irec(dataFRA$FR_DEGR)

## Recodage de dataFRA$FR_DEGR en dataFRA$FR_DEGR_rec
dataFRA$FR_DEGR_rec <- dataFRA$FR_DEGR %>%
  fct_recode(
    "Pas d'étude" = "None",
    "École primaire" = "Primary incomplete",
    "École primaire" = "Primary completed",
    "Secondaire" = "General secondary level 1",
    "Secondaire" = "Vocational secondary level 1",
    "Secondaire" = "Vocational secondary level 2",
    "Secondaire" = "Incomplete general secondary level 2",
    "Secondaire" = "General secondary level 2",
    "Licence" = "College",
    "Master" = "University"
  )

tabCONTRA <- table(dataFRA$CONTRA, dataFRA$EDUCYRS)
write_clip(lprop(tabCONTRA))
